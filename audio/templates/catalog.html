{% extends "base.html" %}
{% load audio_extras %}

{% block content %}

<div style="text-align:center">
	<div id="msg" style="color:red; font-weight:bold; font-size:18px;"></div>
	{%if success%}<div class="successMsg">Your bid has been successfully submitted.</div>{%endif%}

	<div class="header" style="">Our current catalog:{%if not loggedIn%}<div class="successError">You must log in to bid.</div>{%else%}<div>Click <a href="simpleForm">here</a> to enter bids directly.</div>{%endif%}</div>

	<ul id="pagination" class="pagination-sm"></ul>
</div>
{{sort}}
<div class="left">
	<div>Table of contents:</div>
	{%for cat in categories%}

	<div class="leftMenu" id="category_{{cat.id}}" ><a href="?category={{cat.id}}" style="{%if category == cat.id %}color:black{%endif%}">{{cat}}</a></div>
	{%endfor%}
</div>

<div id="tableRight" style="margin-left:auto; margin-right:auto; " class="right">
	<div class="innerRight">
	<div class="tableHeader">
		<div class="left" style="width:70px;">&nbsp;</div>	
		<div class='left clickable {%if sort == "lot_id"%}orderAsc{%endif%}' id="lotIdHeader">{%if sort == "lot_id"%}&#9650;{%endif%} Lot ID:</div>
		<div class="left">Category:</div>
		<div  id="nameHeader" class='left clickable {%if sort == "nameAsc"%}orderAsc{%else%}{%if sort == "-name"%}orderDesc{%endif%}{%endif%}'>{%if sort == "nameAsc"%}&#9650;{%else%}{%if sort == "nameDesc"%}&#9660;{%endif%}{%endif%} Name:</div>
		<div  id="artistHeader" class='left  clickable{%if sort == "artistAsc"%}orderAsc{%else%}{%if sort == "artistDesc"%}orderDesc{%endif%}{%endif%}'>{%if sort == "artistAsc"%}&#9650;{%else%}{%if sort == "artistDesc"%}&#9660;{%endif%}{%endif%} Artist:</div>
		<div class="left">Minimum Bid:</div>
		<div class="clear"></div>
	</div>


	{%for item in catItems%}
	<div class="catalogBox" style="{%if True%}{%endif%}">
		<div style="margin-top:7px; float:left" class="tableBody">
			<div class="catalogItem" style="float:left; width:50px; height:50px; margin-right:20px">
			{%if item.image%}
				{%if item.thumbnail%}<a href="{{STATIC_URL}}audio/images/{{item.image}}" target="_blank"><img src="{{STATIC_URL}}audio/images/{{item.thumbnail}}" width="50px" height="50px"></a>
				{%endif%}
			{%else%}
				{%if item.thumbnail%}<img src="{{STATIC_URL}}audio/images/{{item.thumbnail}}" width="50px" height="50px">
				{%endif%}
			{%endif%}
			</div> 
			<div id="{{item.id}}" class="catalogItem" style="float:left">{{item.lot_id}}</div> 
			<div class="category" style="float:left">{{item.category.name}}</div>
			<div class="category" style="float:left">{{item.name}} {%if item.name_two%}{{item.name_two}}{%endif%}</div>
			<div class="category" style="float:left">{{item.artist}}</div>
			<div class="category" style="float:left">${{item.min_bid}}</div>
		</div>
		<div style="float:left">
			
			{%if not loggedIn%}
			{%else%}

				{%if bids|get_item:item.id == None %}
					
					<div class="left" style="width:175px; margin-top:5px;">
						<div class="left" style="width:10px; margin-top:2px;">$</div>
						<form autocomplete="off">
						<input type="text" name="bidAmount_{{item.id}}" value="" id="bidAmount_{{item.id}}"></form>
					</div>
					<div class="left" style="width:100px;"><button onclick="submitBid({{item.id}})" class="button" >Bid Now</button></div>
				
				{%else%}
						
					<div class="left" style="width:175px; margin-top:5px;">
						<div class="left" style="width:10px; margin-top:2px;">$</div>
						<form autocomplete="off">
						<input type="text" value="{{ bids|get_item:item.id }}" id="bidAmount_{{item.id}}"></form>
					</div>
					<div class="left" style="width:100px;"><button class="button" value="Update Bid" onclick="submitBid({{item.id}})">Update Bid</button></div>
					
					<form class="left" method="POST" action="/audio/catalog/deleteBid">
					 {% csrf_token %}
						<input type ="hidden" name="itemId" value="{{item.id}}">
						<input type="submit" class="bidSubmitButton" value="Delete Bid">
					</form>

				{%endif%}
			{%endif%}

			
		</div>

		<div class="clear"></div>	
	</div>
	{%endfor%}
	</div>
</div>
<div class="clear"></div>	

<script type="text/javascript">
	$(document).ready(function(){
		 $('#pagination').twbsPagination({
		        totalPages: {{total}},
		        startPage:{{number}},
		        onPageClick: function (event, page) {
		        	window.location="?page="+page+"{%if category%}&category={{category}}{%endif%}{%if sort%}&sort={{sort}}{%endif%}"

		        	console.log("sort: {{sort}}")
		        }
		    });

		$("#lotIdHeader").click(function(){
			if(!$(this).hasClass("orderAsc"))
				window.location="?sort=lot_id{%if category%}&category={{category}}{%endif%}{%if page%}&page={{page}}{%endif%}"
				
		})

		$("#nameHeader").click(function(){
			if($(this).hasClass("orderAsc"))
				window.location="?sort=nameDesc{%if category%}&category={{category}}{%endif%}{%if page%}&page={{page}}{%endif%}"
			else
				window.location="?sort=nameAsc{%if category%}&category={{category}}{%endif%}{%if page%}&page={{page}}{%endif%}"
		})

		$("#artistHeader").click(function(){
			if($(this).hasClass("orderAsc"))
				window.location="?sort=artistDesc{%if category%}&category={{category}}{%endif%}{%if page%}&page={{page}}{%endif%}"
			else
				window.location="?sort=artistAsc{%if category%}&category={{category}}{%endif%}{%if page%}&page={{page}}{%endif%}"
		})


	})
</script>

{% endblock %}